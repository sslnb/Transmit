layui.use(["jquery","layer","element","server","common"],function(){var e=layui.jquery,p=(layui.element,layui.layer,layui.common),r=layui.server,a={yesterday:p.timeFormat(new Date(Date.parse(new Date)-864e5)),startTime:p.showdate(0),endTime:p.showdate(-1),init:function(t){this.untreatedWarn(),this.runError(),this.renderRunState(t),this.renderIncreCol(t),this.renderStockCol(t),this.renderUploadCol(t),this.renderServerUseRate(t),this.bindEvent()},bindEvent:function(t){e(".warn-more").click(function(t){t.stopPropagation()}),e(".error-more").click(function(t){t.stopPropagation()})},untreatedWarn:function(){r.untreatedWarn({pageSize:"5",curentPage:"1",sfycl:"2"},function(t){var a="";e.each(t.data.rows,function(t,e){a+='<li><a target="_blank" style="display:block" href="./html/task-manage/task-runState.html">'+e.rwmc+"("+e.kssj+')<span class="li-right">'+e.cwcode+"</span></a></li>"}),e("#warnCon").html(a)},function(t){p.msgError(t.reason||"请求失败")})},runError:function(){r.runError({jgxtlb:""},function(t){var a="";e.each(t.data,function(t,e){a+='<li><a target="_blank" style="display:block" href="./html/monitor-manage/system-monitor/software-run.html">'+e.jgxtlb+"("+e.gxsj+')<span class="li-right">'+e.cwtitle+"</span></a></li>"}),e("#errorCon").html(a)},function(t){p.msgError(t.reason||"请求失败")})},renderRunState:function(t){var n=t.init(document.getElementById("runState")),e={date:this.yesterday};r.warnRate(e,function(t){var e,a;option={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:["异常任务数","正常任务数"]},calculable:!0,series:[{name:"访问来源",type:"pie",radius:"55%",center:["50%","60%"],data:(e=t.data.warn,a=t.data.total,0===e&&0===a?[]:[{value:e,name:"异常任务数"},{value:a-e,name:"正常任务数"}])}]},n.setOption(option)},function(t){p.msgError("请求失败")})},renderStockCol:function(t){var m=t.init(document.getElementById("totalIncre")),e={date:this.yesterday};r.totalChart(e,function(t){var e=t.data.insertl,a=t.data.updatel,n=t.data.deletel,r=t.data.jgxtlb,i=p.arrayssSum(e,a,n),l=[];if(r.length===i.length)for(var o=0;o<r.length;o++){var s={};s.name=r[o],s.value=i[o],l.push(s)}r.unshift("insert","update","delete");var d=p.arraySum(e),u=p.arraySum(a),c=p.arraySum(n);optionStock={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:r},calculable:!1,series:[{name:"今日增量数据采集情况",type:"pie",selectedMode:"single",radius:[0,70],width:"40%",funnelAlign:"right",itemStyle:{normal:{label:{position:"inner"},labelLine:{show:!1}}},data:0===d&&0===u&&0===c?[]:[{value:d,name:"insert"},{value:u,name:"update"},{value:c,name:"delete"}]},{name:"今日增量数据采集情况",type:"pie",radius:[100,140],x:"60%",width:"35%",funnelAlign:"left",data:l}]},m.setOption(optionStock)},function(){p.msgError("请求失败")})},renderIncreCol:function(t){var u=t.init(document.getElementById("totalStock")),e={date:this.yesterday};r.totalChart(e,function(t){var e=t.data.clcjl,a=t.data.cldcjl,n=t.data.jgxtlb,r=p.arraysSum(e,a),i=[];if(n.length===r.length)for(var l=0;l<n.length;l++){var o={};o.name=n[l],o.value=r[l],i.push(o)}n.unshift("已采集","待采集");var s=p.arraySum(e),d=p.arraySum(a);optionStock={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:n},calculable:!1,series:[{name:"今日存量数据采集情况",type:"pie",selectedMode:"single",radius:[0,70],width:"40%",funnelAlign:"right",itemStyle:{normal:{label:{position:"inner"},labelLine:{show:!1}}},data:0===s&&0===d?[]:[{value:s,name:"已采集"},{value:d,name:"待采集"}]},{name:"今日存量数据采集情况",type:"pie",radius:[100,140],x:"60%",width:"35%",funnelAlign:"left",data:i}]},u.setOption(optionStock)},function(){p.msgError("请求失败")})},renderUploadCol:function(t){var m=t.init(document.getElementById("totalUpload")),e={date:this.yesterday};r.totalChart(e,function(t){var e=t.data.clwjscs,a=t.data.zlwjscs,n=t.data.clwjdcs,r=t.data.zlwjdcs,i=t.data.jgxtlb,l=p.arraysssSum(e,a,n,r),o=[];if(i.length===l.length)for(var s=0;s<i.length;s++){var d={};d.name=i[s],d.value=l[s],o.push(d)}i.unshift("已上传","待上传");var u=e.concat(a);u=p.arraySum(u);var c=n.concat(r);c=p.arraySum(c),optionStock={tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:i},calculable:!1,series:[{name:"近日采集文件上传情况",type:"pie",selectedMode:"single",radius:[0,70],width:"40%",funnelAlign:"right",itemStyle:{normal:{label:{position:"inner"},labelLine:{show:!1}}},data:0===u&&0===c?[]:[{value:u,name:"已上传"},{value:c,name:"待上传"}]},{name:"今日存量数据采集情况",type:"pie",radius:[100,140],x:"60%",width:"35%",funnelAlign:"left",data:o}]},m.setOption(optionStock)},function(){p.msgError("请求失败")})},renderServerUseRate:function(t){var e=t.init(document.getElementById("serverUseRate")),a={type:"hour",startTime:this.endTime,endTime:this.startTime};r.hourOrDayChart(a,function(t){0===t.data.time.length&&(t.data.time=["no data"]),e.setOption({tooltip:{trigger:"axis"},legend:{data:["cpu使用率","内存使用率","磁盘使用率","系统负载值"]},xAxis:[{type:"category",boundaryGap:!1,data:t.data.time}],yAxis:[{type:"value",axisLabel:{formatter:"{value} %"}}],series:[{name:"cpu使用率",type:"line",data:t.data.cpu},{name:"内存使用率",type:"line",data:t.data.ram},{name:"磁盘使用率",type:"line",data:t.data.disk},{name:"系统负载值",type:"line",data:t.data.top5}]})},function(){p.msgError("请求失败")})}};require.config({paths:{echarts:"./assets/plugins/echarts"}}),require(["echarts","echarts/chart/pie","echarts/chart/line"],function(t){a.init(t)})});